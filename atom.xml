<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://happyzhihao.github.io</id>
    <title>Gridea</title>
    <updated>2023-04-01T13:10:18.192Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://happyzhihao.github.io"/>
    <link rel="self" href="https://happyzhihao.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://happyzhihao.github.io/images/avatar.png</logo>
    <icon>https://happyzhihao.github.io/favicon.ico</icon>
    <rights>All rights reserved 2023, Gridea</rights>
    <entry>
        <title type="html"><![CDATA[cox model]]></title>
        <id>https://happyzhihao.github.io/post/cox-model/</id>
        <link href="https://happyzhihao.github.io/post/cox-model/">
        </link>
        <updated>2023-04-01T13:02:33.000Z</updated>
        <content type="html"><![CDATA[<pre><code class="language-R">library(survival)
rm(list = ls())
</code></pre>
<h1 id="æ¨¡æ‹Ÿè®¾ç½®">æ¨¡æ‹Ÿè®¾ç½®</h1>
<ul>
<li>ç ”ç©¶å…¥ç»„æ—¶é•¿50ä¸ªæœˆï¼Œéšè®¿æ—¶é•¿180ä¸ªæœˆ</li>
<li>äº‹ä»¶ï¼šåŸºçº¿hazard=0.05ï¼›æœä»weibullåˆ†å¸ƒï¼šHt=(lambda * t)^alpha (è®¾ç½®alpha=2)</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo>(</mo><mi>t</mi><mo>)</mo><mo>=</mo><mo>(</mo><mi>Î»</mi><mi>t</mi><msup><mo>)</mo><mi>Î±</mi></msup></mrow><annotation encoding="application/x-tex">H(t)=(\lambda t)^\alpha
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">Î»</span><span class="mord mathdefault">t</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.0037em;">Î±</span></span></span></span></span></span></span></span></span></span></span></span></p>
<ul>
<li>å¤±è®¿ï¼šhazard=0.01ï¼Œæœä»æŒ‡æ•°åˆ†å¸ƒ</li>
<li>æ»¡è¶³æ¯”ä¾‹é£é™©å‡è®¾</li>
<li>ç»„åˆ«å˜é‡xï¼š0ï¼ˆå¯¹ç…§ç»„ï¼‰ã€1ï¼ˆè¯•éªŒç»„ï¼‰ï¼›cox modelä¸­å›å½’ç³»æ•°beta=0.5</li>
</ul>
<p>è‹¥æ»¡è¶³æ¯”ä¾‹é£é™©å‡å®šï¼Œç´¯ç§¯é£é™©å‡½æ•°Htå­˜åœ¨ä»¥ä¸‹å…³ç³»ï¼šHt=H0t * exp(beta * x)</p>
<p>æ¨¡æ‹Ÿæ­¥éª¤ï¼š</p>
<ul>
<li>(1) è®¡ç®—ç”Ÿå­˜å‡½æ•°Stï¼Œè½¬æ¢ä¸ºç´¯ç§¯æ­»äº¡ç‡å‡½æ•°Ftï¼Œreverse CDF methodè·å¾—ç”Ÿå­˜æ—¶é—´çš„æ¨¡æ‹Ÿæ ·æœ¬</li>
<li>(2) å¤±è®¿æŒ‡æ•°åˆ†å¸ƒï¼Œreverse CDF methodè·å¾—å¤±è®¿æ—¶é—´çš„æ¨¡æ‹Ÿæ ·æœ¬</li>
<li>(3) æ ¹æ®äº‹ä»¶æ—¶é—´ã€å¤±è®¿æ—¶é—´ã€éšè®¿æˆªæ­¢æ—¶é—´åˆ¤æ–­ç»“å±€statuså’Œtimeçš„å–å€¼</li>
</ul>
<h1 id="æ¨¡æ‹Ÿæ•°æ®">æ¨¡æ‹Ÿæ•°æ®</h1>
<p>æ¨¡æ‹Ÿ50000ä¸ªå—è¯•è€…</p>
<pre><code class="language-R">N &lt;- 50000
</code></pre>
<h2 id="æ¯ä¸ªäººçš„äº‹ä»¶æ—¶é—´">æ¯ä¸ªäººçš„äº‹ä»¶æ—¶é—´</h2>
<pre><code class="language-R">set.seed(123)
u_event &lt;- runif(n = N)
x &lt;- sample(c(0, 1), size = N, replace = T, prob = c(0.5, 0.5))

lambda1 &lt;- 0.05
alpha &lt;- 2
beta &lt;- 0.5

t_event &lt;- function(u, lambda, alpha, beta, x) {
  t &lt;- (-log(1 - u) / exp(beta * x))^(1 / alpha) / lambda
  return(t)
}

df &lt;- data.frame(
  T1 = t_event(u_event, lambda1, alpha, beta, x),
  x = x
)
</code></pre>
<h2 id="æ¯ä¸ªäººçš„å¤±è®¿æ—¶é—´">æ¯ä¸ªäººçš„å¤±è®¿æ—¶é—´</h2>
<pre><code class="language-R"># St=exp(-lambda * t)
lambda2 &lt;- 0.01

set.seed(234)
u_loss &lt;- runif(n = N)
t_loss &lt;- function(u, lambda) {
  t &lt;- (-log(1 - u)) / lambda
  return(t)
}

df$T2 &lt;- t_loss(u_loss, lambda2)
</code></pre>
<h2 id="æ¯ä¸ªäººçš„å®é™…éšè®¿æ—¶é•¿">æ¯ä¸ªäººçš„å®é™…éšè®¿æ—¶é•¿</h2>
<pre><code class="language-R"># éšè®¿æ—¶é—´180ä¸ªæœˆ
df$T3 &lt;- 180

# 500ä¸ªäººå…¥ç»„æ—¶é—´æœä»å‡åŒ€åˆ†å¸ƒï¼Œå…¥ç»„æ—¶é—´50ä¸ªæœˆ
set.seed(345)
t_enroll &lt;- runif(n = N, min = 0, max = 50)

# æ¯ä¸ªäººçš„å®é™…éšè®¿æ—¶é•¿
df$T4 &lt;- 180 + 50 - t_enroll
</code></pre>
<pre><code class="language-R">head(df)
</code></pre>
<table class="dataframe">
<caption>A data.frame: 6 Ã— 5</caption>
<thead>
	<tr><th></th><th scope=col>T1</th><th scope=col>x</th><th scope=col>T2</th><th scope=col>T3</th><th scope=col>T4</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td> 9.070059</td><td>1</td><td>136.892606</td><td>180</td><td>219.1873</td></tr>
	<tr><th scope=row>2</th><td>19.408299</td><td>1</td><td>152.194193</td><td>180</td><td>216.2618</td></tr>
	<tr><th scope=row>3</th><td>11.295567</td><td>1</td><td>  2.024058</td><td>180</td><td>210.5037</td></tr>
	<tr><th scope=row>4</th><td>22.816232</td><td>1</td><td>149.649049</td><td>180</td><td>197.2130</td></tr>
	<tr><th scope=row>5</th><td>33.593031</td><td>0</td><td>  6.925372</td><td>180</td><td>208.2067</td></tr>
	<tr><th scope=row>6</th><td> 4.318649</td><td>0</td><td>103.506054</td><td>180</td><td>189.8258</td></tr>
</tbody>
</table>
<h2 id="åˆ¤æ–­ç”Ÿå­˜ç»“å±€timeå’Œstatuså–å€¼">åˆ¤æ–­ç”Ÿå­˜ç»“å±€timeå’Œstatuså–å€¼</h2>
<pre><code class="language-R"># T1ï¼šæ½œåœ¨äº‹ä»¶æ—¶é—´
# T2ï¼šæ½œåœ¨å¤±è®¿æ—¶é—´
# T3ï¼šå…¥ç»„æ—¶é—´
# T4ï¼šæ½œåœ¨éšè®¿æ—¶é•¿(æˆ–éšè®¿ç»ˆæ­¢æ—¶é—´)

df$status &lt;- df$time &lt;- NA

# case1ï¼šäº‹ä»¶æœ€å…ˆå‘ç”Ÿ
df$time[df$T1 &lt;= df$T2 &amp; df$T1 &lt;= df$T4] &lt;-
  df$T1[df$T1 &lt;= df$T2 &amp; df$T1 &lt;= df$T4]
df$status[df$T1 &lt;= df$T2 &amp; df$T1 &lt;= df$T4] &lt;- 1

# case2ï¼šå¤±è®¿æœ€å…ˆå‘ç”Ÿ
df$time[df$T2 &lt;= df$T1 &amp; df$T2 &lt;= df$T4] &lt;-
  df$T2[df$T2 &lt;= df$T1 &amp; df$T2 &lt;= df$T4]
df$status[df$T2 &lt;= df$T1 &amp; df$T2 &lt;= df$T4] &lt;- 0

# case3: éšè®¿ç»ˆæ­¢æœ€å…ˆå‘ç”Ÿ
df$time[df$T4 &lt;= df$T1 &amp; df$T4 &lt;= df$T2] &lt;-
  df$T4[df$T4 &lt;= df$T1 &amp; df$T4 &lt;= df$T2]
df$status[df$T4 &lt;= df$T1 &amp; df$T4 &lt;= df$T2] &lt;- 0

print(apply(df, 2, function(x) sum(is.na(x))))
</code></pre>
<pre><code>    T1      x     T2     T3     T4   time status 
     0      0      0      0      0      0      0 
</code></pre>
<h1 id="æ‹Ÿåˆcoxæ¯”ä¾‹é£é™©æ¨¡å‹">æ‹ŸåˆCoxæ¯”ä¾‹é£é™©æ¨¡å‹</h1>
<p>å›å½’ç³»æ•°0.499626çº¦ç­‰äºæ¨¡æ‹Ÿä¸­è®¾å®šçš„beta=0.5</p>
<p>è¯•éªŒç»„ç›¸æ¯”å¯¹ç…§ç»„ï¼Œé£é™©å¢åŠ 64.8%</p>
<pre><code class="language-R">df$x &lt;- factor(df$x, levels = c(0, 1))
fit_cox &lt;- coxph(Surv(time = time, event = status) ~ x, data = df)
summary(fit_cox)
</code></pre>
<pre><code>Call:
coxph(formula = Surv(time = time, event = status) ~ x, data = df)

  n= 50000, number of events= 42866 

       coef exp(coef) se(coef)     z Pr(&gt;|z|)    
x1 0.499626  1.648104 0.009907 50.43   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

   exp(coef) exp(-coef) lower .95 upper .95
x1     1.648     0.6068     1.616      1.68

Concordance= 0.562  (se = 0.001 )
Likelihood ratio test= 2533  on 1 df,   p=&lt;2e-16
Wald test            = 2543  on 1 df,   p=&lt;2e-16
Score (logrank) test = 2591  on 1 df,   p=&lt;2e-16
</code></pre>
<h1 id="æ‹ŸåˆåŠ é€Ÿæ—¶é—´å¤±æ•ˆæ¨¡å‹aft">æ‹ŸåˆåŠ é€Ÿæ—¶é—´å¤±æ•ˆæ¨¡å‹ï¼ˆAFTï¼‰</h1>
<p>AFT modelç»™å‡ºç»„åˆ«çš„æ•ˆåº”å€¼ï¼šç›¸æ¯”äºå¯¹ç…§ç»„ï¼Œè¯•éªŒç»„ç”Ÿå­˜æ—¶é—´å‡å°‘22.1%</p>
<p>ç›¸æ¯”äºcox modelï¼Œè¯¥æ¨¡å‹ä¹Ÿç»™å‡ºåŸºçº¿weibullåˆ†å¸ƒçš„å‚æ•°</p>
<pre><code class="language-R">round(exp(-0.25003) - 1, 3)
</code></pre>
<p>-0.221</p>
<pre><code class="language-R">fit_aft &lt;- survreg(Surv(time = time, event = status) ~ x, data = df, dist=&quot;weibull&quot;)
summary(fit_aft)
</code></pre>
<pre><code>Call:
survreg(formula = Surv(time = time, event = status) ~ x, data = df, 
    dist = &quot;weibull&quot;)
               Value Std. Error      z      p
(Intercept)  2.99048    0.00349  856.0 &lt;2e-16
x1          -0.25003    0.00483  -51.7 &lt;2e-16
Log(scale)  -0.69264    0.00371 -186.8 &lt;2e-16

Scale= 0.5 

Weibull distribution
Loglik(model)= -150325.6   Loglik(intercept only)= -151612.7
	Chisq= 2574.29 on 1 degrees of freedom, p= 0 
Number of Newton-Raphson Iterations: 7 
n= 50000 
</code></pre>
<p>fit_aft$scaleå³ä¸ºæ¨¡æ‹Ÿä¸­weibullåˆ†å¸ƒçš„1/alpha</p>
<pre><code class="language-R">fit_aft$scale
</code></pre>
<p>0.500252883887261</p>
<p>exp(coef(fit_aft)[1])å³ä¸ºæ¨¡æ‹Ÿä¸­weibullåˆ†å¸ƒçš„1 / lambda1</p>
<pre><code class="language-R">exp(coef(fit_aft)[1])
1 / lambda1
</code></pre>
<p><strong>(Intercept):</strong> 19.8951527049807</p>
<p>20</p>
<h1 id="coxä¸aft-modelå›å½’ç³»æ•°å¯¹åº”">Coxä¸AFT modelå›å½’ç³»æ•°å¯¹åº”</h1>
<p>AFT modelçš„å›å½’ç³»æ•°/scale=-0.499800916384525çº¦ç­‰äºcox modelçš„å›å½’ç³»æ•°0.499626</p>
<pre><code class="language-R">coef(fit_aft)[2] / fit_aft$scale
</code></pre>
<p><strong>x1:</strong> -0.499800916384525</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Test title]]></title>
        <id>https://happyzhihao.github.io/post/test-title/</id>
        <link href="https://happyzhihao.github.io/post/test-title/">
        </link>
        <updated>2023-03-26T02:07:40.000Z</updated>
        <content type="html"><![CDATA[<p>æµ‹è¯•å›¾ç‰‡<br>
<img src="https://zhihao-pku.oss-cn-beijing.aliyuncs.com/202303261008662.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://happyzhihao.github.io/post/hello-gridea/</id>
        <link href="https://happyzhihao.github.io/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="https://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>