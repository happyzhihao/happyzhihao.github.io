{
  "hash": "026e85adfdda89a3c09a8cc70a341205",
  "result": {
    "markdown": "---\ntitle: \"number of events needed in survival analysis\"\ndescription: \"\"\nauthor: \"Zhihao\"\ndate: \"4/9/2023\"\ncategories: [R, sample size, statistic]\nimage: \"image.jpg\"\ndraft: false\nfreeze: false\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsDesign)\n## Loading required package: ggplot2\n## Warning: package 'ggplot2' was built under R version 4.2.3\nrm(list = ls())\n```\n:::\n\n\nusing the `nEvents` function from gsDesign to calculate the number of events\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(nE <- nEvents(hr = 0.6, alpha = 0.025, beta = 0.2))\n## [1] 120.3157\n```\n:::\n\n\nthe $log(HR)$ under null distribution\\~$N(0, \\frac{1}{d_1} + \\frac{1}{d_2})$. To control for the type 1 error no more than one sided 0.025, we could derived the critical value for significance test.\n\nThe variance of $log(HR)=\\frac{1}{d_1} + \\frac{1}{d_2}$ was derived based on exponential distribution, using the maximum likelihood method to estimate the parameter:\n\nFirst, considering one treatment setting $$Likelihood=\\prod_{i=1}^{n}f(t)^{\\delta_i}S(t)^{1-\\delta_i}$$ where n is size all subjects; if the subject occur event, then $\\delta_i=1$; f(t) is the probability density function of survival time, and S(t) is the survival function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- nE\nz_cut <- qnorm(\n  p = 1 - 0.975,\n  mean = 0,\n  sd = sqrt(4 / d)\n)\nz_cut\n## [1] -0.357369\n```\n:::\n\n\nUnder the alternative hyperthesis, the $log(HR)$ obeys distribution of $N(log(hr), \\frac{1}{d_1} + \\frac{1}{d_2})$. Here we also used the standard distribution under null hyperthesis as other statistic software (e.g, EAST).\n\n\n::: {.cell}\n\n```{.r .cell-code}\npnorm(\n  q = z_cut,\n  mean = log(0.6),\n  sd = sqrt(4 / d)\n)\n## [1] 0.8\n```\n:::\n\n\nThe variance of log(hr) $\\frac{1}{d_1} + \\frac{1}{d_2}$ could also be expressed:\n\n$$\\frac{1}{r(1-r)D}$$ where D is the total number events of control and active treatments, r is the event proportion from control treatment.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# control / event\n(nE <- nEvents(hr = 1.4, alpha = 0.025, beta = 0.2, ratio = 0.5))\n## [1] 311.9764\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- nE\nr <- 1 / 3\nsd <- sqrt(1 / (r * (1 - r) * d))\n\nz_cut <- qnorm(\n  p = 0.975,\n  mean = 0,\n  sd = sd\n)\nz_cut\n## [1] 0.235393\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n1 - pnorm(\n  q = z_cut,\n  mean = log(1.4),\n  sd = sd\n)\n## [1] 0.8\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}